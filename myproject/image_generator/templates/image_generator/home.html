{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container text-center">
    <h1 class="display-4 mb-4">Welcome to AI Visual Diary</h1>
    
    <div id="modelStatus" class="mb-4">
        {% if model_status == 'COMPLETE' %}
            <div class="alert alert-success">
                <h4>Your Custom Model is Ready!</h4>
                <p>Model ID: {{ model_id }}</p>
                <a href="{% url 'image_generator:upload_diary' %}" class="btn btn-lg custom-btn-green">
                    Upload Your Diary
                </a>
            </div>
        {% else %}
            <div class="alert alert-warning">
                <h4>No Custom Model Found</h4>
                <p>Please start by creating your character.</p>
                <a href="{% url 'image_generator:generate_avatars' %}" class="btn btn-lg custom-btn-blue">
                    Create Your Character
                </a>
            </div>
        {% endif %}
    </div>
</div>

{% if model_status == 'TRAINING' %}
<script>
    // 每5秒检查一次模型状态
    function checkModelStatus() {
        fetch('/check-model-status/{{ model_id }}/')
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success' && data.training_status === 'COMPLETE') {
                    // 如果模型训练完成，刷新页面
                    window.location.reload();
                } else if (data.status === 'success' && data.training_status === 'TRAINING') {
                    // 如果还在训练，继续检查
                    setTimeout(checkModelStatus, 5000);
                }
            })
            .catch(error => console.error('Error:', error));
    }

    // 开始检查
    checkModelStatus();
</script>
{% endif %}
{% endblock %}